<h2 class="title"> {{ staticNames.ProjectProperties }} </h2>

<mat-dialog-content class="content">
  <div *ngIf="project$ | async as project">
    <mat-tab-group>
      <mat-tab label="Project">
        <div fxLayout="column" fxLayoutAlign="space-around center">
          <mat-form-field>
            <input matInput
                   [disabled]="disableInput$ | async"
                   [(ngModel)]="project.code"
                   name="Code"
                   placeholder="{{ staticNames.ProjectCode }}" />
          </mat-form-field>
          
          <mat-form-field>
            <input matInput
                   [disabled]="disableInput$ | async"
                   [(ngModel)]="project.displayName"
                   name="Name"
                   placeholder="{{ staticNames.ProjectName }}" />
          </mat-form-field>

          <mat-form-field>
            <mat-label>{{ staticNames.ProjectReleaseDate }}</mat-label>
            <input matInput 
                  [disabled]="disableInput$ | async" 
                  [matDatepicker]="dp3"
                  [(ngModel)]="project.releaseDate"
                  name="releaseDate">
            <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
            <mat-datepicker #dp3 disabled="false"></mat-datepicker>
          </mat-form-field>

          <mat-form-field>
            <mat-label>{{ staticNames.ProjectCategory }}</mat-label>
            <mat-select [(ngModel)]="project.category.id"
                        [disabled]="disableInput$ | async">
              <mat-option *ngFor="let ctg of categories$.value" [value]="ctg.id" >
                {{ctg.displayName}} 
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field>
            <textarea matInput
                      [disabled]="disableInput$ | async"
                      [(ngModel)]="project.descriptionShort"
                      name="descriptionShort" 
                      cdkTextareaAutosize 
                      #autosize="cdkTextareaAutosize"
                      cdkAutosizeMinRows="1"
                      cdkAutosizeMaxRows="10"
                      placeholder="{{ staticNames.ProjectDescriptionShort }}">
            </textarea>
          </mat-form-field>

          <mat-form-field>
            <textarea matInput
                      [disabled]="disableInput$ | async"
                      [(ngModel)]="project.description"
                      name="description" 
                      cdkTextareaAutosize 
                      #autosize="cdkTextareaAutosize"
                      cdkAutosizeMinRows="1"
                      cdkAutosizeMaxRows="10"
                      placeholder="{{ staticNames.ProjectDescription }}">
            </textarea>
          </mat-form-field>
      </div>
    </mat-tab>

    <mat-tab label="{{ staticNames.ProjectPoster }}">
      <div fxLayout="column" fxLayoutAlign="space-around center">
        <div fxLayout="row" fxLayoutAlign="center center" >
          <img [ngClass]="{'disabled': disableInput$ | async }"
               class="posterImage"
               src="{{(project.posterPreview || project.posterUrl)}}" />
        </div>
          
        <mat-form-field>
          <input matInput
                 [disabled]="disableInput$ | async"
                 [(ngModel)]="project.posterDescription"
                 name="posterDescriptionle"
                 placeholder="{{ staticNames.ProjectPosterDescription }}" />
        </mat-form-field>

        <div class="wide-position">
          <app-file-uploader 
                [disabled] = "disableInput$ | async"
                [filename] = "project.posterUrl"
                (uploadFiles) = "selectFile($event)"
                (deleteFile) = "deleteFile()">
          </app-file-uploader>
        </div>

      </div>
    </mat-tab>

    <mat-tab label="{{ staticNames.ExternalUrls }}">
      <table mat-table 
             class="dialogTable" 
             #externalUrlsTable 
             [dataSource]="project.externalUrls">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>{{ staticNames.ExternalUrlName }}</th>
          <td mat-cell *matCellDef="let element">
            <mat-form-field floatLabel="never">
              <input matInput placeholder="Name" [value]="element.displayName" [(ngModel)]="element.displayName" />
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef> {{ staticNames.ExternalUrlCreate }} </td>
        </ng-container>

        <ng-container matColumnDef="url">
          <th mat-header-cell *matHeaderCellDef>{{ staticNames.ExternalUrl }}</th>
          <td mat-cell *matCellDef="let element">
            <mat-form-field floatLabel="never">
              <input matInput placeholder="{{ staticNames.ExternalUrl }}"
                    [value]="element.url"
                    [(ngModel)]="element.url" />
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef>  </td>
        </ng-container>

        <ng-container matColumnDef="btn">
          <th mat-header-cell *matHeaderCellDef> </th>
          <td mat-cell  *matCellDef="let element"> 
            <app-button [isDisabled]="disableInput$ | async" 
                        (click)="removeUrl(element)">{{ staticNames.GenericDelete }}</app-button>
          </td>
    
          <td mat-footer-cell *matFooterCellDef> </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="columnsInner" style="display: none;"></tr>
        <tr mat-row *matRowDef="let row; columns: columnsInner"></tr>
        <tr mat-footer-row *matFooterRowDef="columnsInner" (click)="addUrl()"></tr>
      </table>

    </mat-tab>

    <mat-tab label="{{ staticNames.Gallery }}">

      <table mat-table 
             class="dialogTable"
             #galleryImagesTable
             [dataSource]="project.galleryImages">
        <ng-container matColumnDef="imageUrl">
          <th mat-header-cell *matHeaderCellDef>{{ staticNames.GalleryImageUrl }}</th>
          <td mat-cell *matCellDef="let element">           
            <img class="small-gallery" src="{{(element.localPreview || element.imageUrl)}}" />
          </td>
          <td mat-footer-cell *matFooterCellDef> {{ staticNames.GalleryAdd }} </td>
        </ng-container>

        <ng-container matColumnDef="extraUrl">
          <th mat-header-cell *matHeaderCellDef> {{ staticNames.GalleryExtraUrl }}</th>
          <td mat-cell *matCellDef="let element">
            <mat-form-field floatLabel="never">
              <input matInput
                     placeholder="{{ staticNames.GalleryExtraUrl }}"
                     [value]="element.extraUrl"
                     [(ngModel)]="element.extraUrl" />
            </mat-form-field>
          </td>
          <td mat-footer-cell *matFooterCellDef>  </td>
        </ng-container>

        <ng-container matColumnDef="btn">
          <th mat-header-cell *matHeaderCellDef> </th>
          <td mat-cell  *matCellDef="let element"> 
            <app-file-uploader 
                [disabled] = "disableInput$ | async"
                [filename] = "element.imageUrl"
                (uploadFiles) = "selectGalleryFile($event, element)"
                (deleteFile) = "removeGalleryImage(element)">
              </app-file-uploader>
          </td>
    
          <td mat-footer-cell *matFooterCellDef> </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="columnsGallery" style="display: none;"></tr>
        <tr mat-row *matRowDef="let row; columns: columnsGallery"></tr>
        <tr mat-footer-row *matFooterRowDef="columnsGallery" (click)="addGalleryImage()"></tr>
      </table>

    </mat-tab>
  </mat-tab-group>
  </div>

</mat-dialog-content>

<div *ngIf="message$ | async as msg">
  <app-message [message]="msg"></app-message>
</div>

<div class="actions" fxHide.lt-md="true">
  <div class="actions-left">
    <app-button [isDisabled]="disableInput$ | async" 
                (OnClick)="delete()">
                {{ staticNames.GenericDelete }}
    </app-button>
  </div>
  <div class="actions-right">
    <app-button [isDisabled]="disableInput$ | async" (OnClick)="save()">{{ staticNames.GenericSave }}</app-button>
    <app-button (OnClick)="close()">{{ staticNames.GenericClose }}</app-button>
  </div>
</div>
